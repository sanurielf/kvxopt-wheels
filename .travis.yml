env:
    global:
        - UPLOAD_TO_WASABY=0

        - REPO_DIR=kvxopt
        # Commit from your-project that you want to build
        - BUILD_COMMIT=1.2.6.0
        # pip dependencies to _build_ your project
        - BUILD_DEPENDS=""
        - TEST_DEPENDS="pytest"
        - PLAT=x86_64
        - UNICODE_WIDTH=32
        # pip dependencies to _test_ your project.  Include any dependencies
        # that you need, that are also specified in BUILD_DEPENDS, this will be
        # a separate install.
        # Now see the Uploads section for the stuff you need to
        # upload your wheels after CI has built them.

# You will likely prefer "language: generic" for travis configuration,
# rather than, say "language: python". Multibuild doesn't use
# Travis-provided Python but rather installs and uses its own, where the
# Python version is set from the MB_PYTHON_VERSION variable. You can still
# specify a language here if you need it for some unrelated logic and you
# can't use Multibuild-provided Python or other software present on a
# builder.
language: generic

# For CPython macOS builds only, the minimum supported macOS version and
# architectures of any C extensions in the wheel are set with the variable
# MB_PYTHON_OSX_VER: 10.9 (64-bit only) or 10.6 (64/32-bit dual arch). By
# default this is set to the highest available for the Python version selected
# using MB_PYTHON_VERSION. You should only need to set this explicitly if you
# are building a 10.6 dual-arch build for a CPython version where both a 10.9 and
# 10.6 build are available (for example, 2.7 or 3.7).
# All PyPy macOS builds are 64-bit only.

# Required in Linux to invoke `docker` ourselves
services: docker



# Host distribution.  This is the distribution from which we run the build
# and test containers, via docker.
dist: xenial


matrix:
  include:
    # OSX builds
    - os: osx
      env:
        - MB_PYTHON_VERSION=2.7
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.5
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.6
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.7
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.8
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.9

    # 64-bit linux builds
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - MB_ML_VER=1
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.5
        - MB_ML_VER=1
    - os: linux
      env: 
        - MB_PYTHON_VERSION=3.5
        - MB_ML_VER=2014
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.6
        - MB_ML_VER=1
    - os: linux
      env: 
        - MB_PYTHON_VERSION=3.6
        - MB_ML_VER=2014
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.7
        - MB_ML_VER=1
    - os: linux
      env: 
        - MB_PYTHON_VERSION=3.7
        - MB_ML_VER=2014
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.8
        - MB_ML_VER=1
    - os: linux
      env: 
        - MB_PYTHON_VERSION=3.8
        - MB_ML_VER=2014
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.9
        - MB_ML_VER=1
    - os: linux
      env: 
        - MB_PYTHON_VERSION=3.9
        - MB_ML_VER=2014

    # 32-bit linux builds
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - MB_ML_VER=1
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.5
        - MB_ML_VER=1
        - PLAT=i686
    - os: linux
      env: 
        - MB_PYTHON_VERSION=3.5
        - MB_ML_VER=2014
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.6
        - MB_ML_VER=1
        - PLAT=i686
    - os: linux
      env: 
        - MB_PYTHON_VERSION=3.6
        - MB_ML_VER=2014
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.7
        - MB_ML_VER=1
        - PLAT=i686
    - os: linux
      env: 
        - MB_PYTHON_VERSION=3.7
        - MB_ML_VER=2014
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.8
        - MB_ML_VER=1
        - PLAT=i686
    - os: linux
      env: 
        - MB_PYTHON_VERSION=3.8
        - MB_ML_VER=2014
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.9
        - MB_ML_VER=1
        - PLAT=i686
    - os: linux
      env: 
        - MB_PYTHON_VERSION=3.9
        - MB_ML_VER=2014
        - PLAT=i686


before_install:
    - source multibuild/common_utils.sh
    - source multibuild/travis_steps.sh
    - before_install

install:
    # Maybe get and clean and patch source
    - clean_code $REPO_DIR $BUILD_COMMIT
    - build_wheel $REPO_DIR $PLAT

script:
    - install_run $PLAT

before_deploy: cd ${TRAVIS_BUILD_DIR}/wheelhouse

deploy:
  provider: s3
  region: us-west-1
  verbose: true
  endpoint: s3.us-west-1.wasabisys.com
  access_key_id:
    secure: "SKQffPYToTjYwn4AzmgLfQ43BKfIieAFS/6fAy/muWZiWqz+k7RqvkHFQs3cONn1E9cI+m27TNVtN5JogoaGmfZKVbOB7FyDtcXdr2HV07k7WfPUEHQXhe6lCLRyzz2KVcdnafijll9hrSlQvt5cC8A5qCmWmsDE38s+0kmgArq8BHs5tsdH9BVn/9neQMtAsdTb349owPm5CFumCDxvIgFAhr3/d4KfRNwKdjhRac39AhkeOqet26oAesRWYlHuOplvjA6ZKY1tBIax/YwzhDiPf49qehy1HOwxAMKUfcRY680Aa3B2yivmJO8W5wFEA9v+dM97gyvjcAHKdXB4El497mLSWDzuo4YcmtpH9QW8arpoVJZPMmzbW9iU6zOg2iBF9sBw2jbEAImBriZQnUU3xhXxV00a2N+8ufp83NDTB3H+hS0AuXFAbDckhn8UbOdzc19IxrZGOFj+HL+mZ4WZOnkHKdM6ozPFl62RPOspgJaidCPeKBYCaxoUbAOjXSFMjTfk0JPaVmhEMeeH4aq/jxuiAVDIoJDT0KCtGDHJxYWRxNTsjWJr2TbpQTnNrPlHAUbBeHysZ0csfCpw2a6Z2sKEZ7xI4XnjXUXuubPPkiCEMvaCuFkuLkO/4FSmegtouYmobZo530J+gfmVtHgr5CPOzRxB8J+Kf8CBiq4="
  secret_access_key: 
    secure: "F0gazKiqBst2KLNeoVHcY9iPAoibhbq0zI37nxzux2mEhXQ7MCO3OVuH/edJzbhFBPnmT/DpZUGnrDSoNzR64fT99mxYF/miyfwPU8mhb/NE1TOj1CrmqKQL8ViNBnaXdKG6THYjEif+r9VX7vmibCyxFaAU7DUNf+w95fUooxTGD09PWdk4bqNiQwZLCPKrVbwIdxm7cQZqPpIw9ptUEmB7eZPpqY3nxUWytSTzLmlFq9vyBfhIdFJiHi/Bhi1Pf1HIOeNMak1HOHQ+MIeo5lq+SsZMjAfzeDK6GPBVloVYRp4SJU1mXhqTwJ6TjY4ag0iY2FMitXcsGEsH1MTn9s5zf95Ul+a8yn5rELaDgYIficLJJukkGS28JMu8fxTP8tJQLu3c2ZGW0KpmUfBb1tpSmth2+zxv/V9BpFZyzkb/XfPNtqezHd/BIXbeM/NlRy8g4z2EC3TuTDQKiWgcYcMsBGG6Oj/uyOhzs2qvikWyN2etUC8VoGKAWkmrR/roX1tBvVyJ6kaH9XL2RO+mFSK6LIzGbCPGJM2/RqVRBLr4auBCoh51uWF+e/DJUj5XsFcuKUi8rYambztqacplv0icuNBwGYO2aYvj1WqHAMwBljTCE2Jt2mNdRyA/42o37fOHVd/MTRT889VfS06i/FLjZIa6SOyJYPltk5SRVE8="
  bucket: kvxoptwheels
  on:
    repo: sanurielf/kvxopt-wheels
    branch: master
    condition: $UPLOAD_TO_WASABY = 1


after_success:
    # Here you should put the code to upload your wheels
    # See the Uploads section for more details.